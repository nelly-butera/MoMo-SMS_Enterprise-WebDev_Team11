{
  "schema_version": "1.0",
  "description": "JSON schemas for MoMo SMS Data Processing System - mapping relational database entities to JSON API responses",
  
  "entities": {
    
    "user": {
      "description": "Individual user/customer entity - maps to 'users' table",
      "sql_table": "users",
      "example": {
        "userId": 1001,
        "firstName": "Jean",
        "middleName": "Claude",
        "lastName": "Mukasa",
        "phoneNumber": "+250788123456",
        "accountType": "personal",
        "createdAt": "2025-01-15T10:30:00Z",
        "statistics": {
          "totalTransactions": 45,
          "totalSent": 1250000.00,
          "totalReceived": 890000.00,
          "lastTransactionDate": "2025-01-25T14:22:00Z"
        }
      }
    },

    "transaction_category": {
      "description": "Transaction category/type entity - maps to 'transaction_categories' table",
      "sql_table": "transaction_categories",
      "example": {
        "categoryId": 5,
        "categoryName": "Bill Payment",
        "description": "Payments for utilities, services, and bills",
        "transactionCount": 1203,
        "metadata": {
          "icon": "bill",
          "color": "#FF6B6B",
          "isActive": true
        }
      }
    },

    "raw_sms": {
      "description": "Raw SMS data entity - maps to 'rsw_sms' table",
      "sql_table": "rsw_sms",
      "example": {
        "smsId": 2501,
        "smsProtocol": "SMS",
        "senderAddress": "+250788999111",
        "serviceCenter": "+250788000000",
        "smsBody": "You have received RWF 50,000 from MUKASA Jean +250788123456. Your balance is RWF 125,000. TxRef: ABC123XYZ456",
        "processedStatus": "processed",
        "receivedDate": "2025-01-25T14:20:15Z",
        "createdAt": "2025-01-25T14:20:20Z",
        "processingMetadata": {
          "attempts": 1,
          "processingTime": 0.345,
          "errors": null
        }
      }
    },

    "system_log": {
      "description": "System logging entity - maps to 'system_logs' table",
      "sql_table": "system_logs",
      "example": {
        "logId": 10523,
        "status": "success",
        "source": "ETL_Pipeline",
        "message": "Successfully processed 150 SMS transactions in batch #2501",
        "loggedAt": "2025-01-25T14:25:30Z",
        "details": {
          "batchId": 2501,
          "recordsProcessed": 150,
          "recordsFailed": 2,
          "duration": 12.5
        }
      }
    },

    "transaction_participant": {
      "description": "Transaction participant junction entity - maps to 'transaction_participants' table",
      "sql_table": "transaction_participants",
      "example": {
        "participantId": 5001,
        "transactionId": 3500,
        "userId": 1001,
        "role": "sender",
        "user": {
          "userId": 1001,
          "firstName": "Jean",
          "lastName": "Mukasa",
          "phoneNumber": "+250788123456"
        }
      }
    },

    "transaction_simple": {
      "description": "Basic transaction entity - maps to 'transactions' table",
      "sql_table": "transactions",
      "example": {
        "transactionId": 3500,
        "txRef": "ABC123XYZ456",
        "categoryId": 3,
        "rawSmsId": 2501,
        "amount": 50000.00,
        "fee": 100.00,
        "balanceAfter": 125000.00,
        "transactionDate": "2025-01-25T14:20:00Z",
        "createdAt": "2025-01-25T14:20:25Z"
      }
    },

    "transaction_complete": {
      "description": "Complete transaction with all related data - demonstrates sophisticated nesting",
      "sql_tables": "transactions + users + transaction_categories + transaction_participants + rsw_sms",
      "example": {
        "transactionId": 3500,
        "txRef": "ABC123XYZ456",
        "amount": 50000.00,
        "fee": 100.00,
        "balanceAfter": 125000.00,
        "transactionDate": "2025-01-25T14:20:00Z",
        "createdAt": "2025-01-25T14:20:25Z",
        
        "category": {
          "categoryId": 3,
          "categoryName": "Money Transfer",
          "description": "Peer-to-peer money transfers",
          "metadata": {
            "icon": "transfer",
            "color": "#4ECDC4"
          }
        },
        
        "participants": [
          {
            "participantId": 5001,
            "role": "sender",
            "user": {
              "userId": 1001,
              "firstName": "Jean",
              "middleName": "Claude",
              "lastName": "Mukasa",
              "phoneNumber": "+250788123456",
              "accountType": "personal"
            }
          },
          {
            "participantId": 5002,
            "role": "receiver",
            "user": {
              "userId": 1002,
              "firstName": "Marie",
              "middleName": null,
              "lastName": "Uwase",
              "phoneNumber": "+250788654321",
              "accountType": "personal"
            }
          }
        ],
        
        "rawSms": {
          "smsId": 2501,
          "smsProtocol": "SMS",
          "senderAddress": "+250788999111",
          "smsBody": "You have received RWF 50,000 from MUKASA Jean +250788123456. Your balance is RWF 125,000. TxRef: ABC123XYZ456",
          "receivedDate": "2025-01-25T14:20:15Z",
          "processedStatus": "processed"
        },
        
        "metadata": {
          "processingTime": 0.345,
          "source": "MoMo_SMS",
          "verified": true,
          "fraudScore": 0.02
        }
      }
    }
  },

  "api_responses": {
    
    "get_transaction_by_id": {
      "description": "API response for GET /api/transactions/{id}",
      "endpoint": "GET /api/transactions/3500",
      "response": {
        "success": true,
        "timestamp": "2025-01-26T08:30:00Z",
        "data": {
          "transactionId": 3500,
          "txRef": "ABC123XYZ456",
          "amount": 50000.00,
          "fee": 100.00,
          "balanceAfter": 125000.00,
          "transactionDate": "2025-01-25T14:20:00Z",
          "category": {
            "categoryId": 3,
            "categoryName": "Money Transfer",
            "description": "Peer-to-peer money transfers"
          },
          "participants": [
            {
              "role": "sender",
              "user": {
                "userId": 1001,
                "firstName": "Jean",
                "lastName": "Mukasa",
                "phoneNumber": "+250788123456"
              }
            },
            {
              "role": "receiver",
              "user": {
                "userId": 1002,
                "firstName": "Marie",
                "lastName": "Uwase",
                "phoneNumber": "+250788654321"
              }
            }
          ]
        }
      }
    },

    "get_user_transactions": {
      "description": "API response for GET /api/users/{userId}/transactions",
      "endpoint": "GET /api/users/1001/transactions?limit=10&offset=0",
      "response": {
        "success": true,
        "timestamp": "2025-01-26T08:35:00Z",
        "pagination": {
          "limit": 10,
          "offset": 0,
          "total": 45,
          "hasMore": true
        },
        "data": {
          "user": {
            "userId": 1001,
            "firstName": "Jean",
            "lastName": "Mukasa",
            "phoneNumber": "+250788123456"
          },
          "transactions": [
            {
              "transactionId": 3500,
              "txRef": "ABC123XYZ456",
              "amount": 50000.00,
              "fee": 100.00,
              "role": "sender",
              "transactionDate": "2025-01-25T14:20:00Z",
              "category": "Money Transfer",
              "counterparty": {
                "firstName": "Marie",
                "lastName": "Uwase",
                "phoneNumber": "+250788654321"
              }
            },
            {
              "transactionId": 3499,
              "txRef": "DEF789GHI012",
              "amount": 25000.00,
              "fee": 50.00,
              "role": "receiver",
              "transactionDate": "2025-01-24T11:15:00Z",
              "category": "Money Transfer",
              "counterparty": {
                "firstName": "Paul",
                "lastName": "Nkusi",
                "phoneNumber": "+250788111222"
              }
            }
          ],
          "summary": {
            "totalTransactions": 45,
            "totalSent": 1250000.00,
            "totalReceived": 890000.00,
            "netFlow": -360000.00
          }
        }
      }
    },

    "get_transactions_by_category": {
      "description": "API response for GET /api/transactions/category/{categoryId}",
      "endpoint": "GET /api/transactions/category/3",
      "response": {
        "success": true,
        "timestamp": "2025-01-26T08:40:00Z",
        "data": {
          "category": {
            "categoryId": 3,
            "categoryName": "Money Transfer",
            "description": "Peer-to-peer money transfers",
            "transactionCount": 1520
          },
          "transactions": [
            {
              "transactionId": 3500,
              "txRef": "ABC123XYZ456",
              "amount": 50000.00,
              "transactionDate": "2025-01-25T14:20:00Z",
              "sender": {
                "firstName": "Jean",
                "lastName": "Mukasa"
              },
              "receiver": {
                "firstName": "Marie",
                "lastName": "Uwase"
              }
            }
          ],
          "analytics": {
            "totalVolume": 152500000.00,
            "averageAmount": 100328.95,
            "totalFees": 152500.00
          }
        }
      }
    },

    "post_process_sms": {
      "description": "API response for POST /api/sms/process",
      "endpoint": "POST /api/sms/process",
      "request": {
        "smsBody": "You have sent RWF 75,000 to UWASE Marie +250788654321. Your balance is RWF 425,000. Fee: RWF 150. TxRef: XYZ987ABC654",
        "senderAddress": "+250788999111",
        "receivedDate": "2025-01-26T09:00:00Z"
      },
      "response": {
        "success": true,
        "timestamp": "2025-01-26T09:00:05Z",
        "data": {
          "smsId": 2502,
          "processedStatus": "processed",
          "transaction": {
            "transactionId": 3501,
            "txRef": "XYZ987ABC654",
            "amount": 75000.00,
            "fee": 150.00,
            "balanceAfter": 425000.00,
            "category": {
              "categoryId": 3,
              "categoryName": "Money Transfer"
            },
            "participants": [
              {
                "role": "sender",
                "phoneNumber": "+250788123456"
              },
              {
                "role": "receiver",
                "phoneNumber": "+250788654321"
              }
            ]
          },
          "processingMetadata": {
            "processingTime": 0.289,
            "parsingRules": ["transfer_pattern_v2"],
            "confidence": 0.98
          }
        }
      }
    },

    "get_dashboard_analytics": {
      "description": "API response for GET /api/analytics/dashboard",
      "endpoint": "GET /api/analytics/dashboard?period=7days",
      "response": {
        "success": true,
        "timestamp": "2025-01-26T09:10:00Z",
        "data": {
          "period": {
            "start": "2025-01-19T00:00:00Z",
            "end": "2025-01-26T09:10:00Z",
            "days": 7
          },
          "overview": {
            "totalTransactions": 3420,
            "totalVolume": 512500000.00,
            "totalFees": 512500.00,
            "averageTransactionAmount": 149853.80,
            "uniqueUsers": 1250
          },
          "byCategory": [
            {
              "categoryId": 3,
              "categoryName": "Money Transfer",
              "transactionCount": 1520,
              "totalVolume": 225000000.00,
              "percentage": 43.9
            },
            {
              "categoryId": 5,
              "categoryName": "Bill Payment",
              "transactionCount": 1100,
              "totalVolume": 185000000.00,
              "percentage": 36.1
            },
            {
              "categoryId": 7,
              "categoryName": "Airtime Purchase",
              "transactionCount": 800,
              "totalVolume": 102500000.00,
              "percentage": 20.0
            }
          ],
          "topUsers": [
            {
              "userId": 1001,
              "firstName": "Jean",
              "lastName": "Mukasa",
              "transactionCount": 45,
              "totalVolume": 2250000.00
            },
            {
              "userId": 1015,
              "firstName": "Alice",
              "lastName": "Uwera",
              "transactionCount": 38,
              "totalVolume": 1890000.00
            }
          ],
          "dailyTrend": [
            {
              "date": "2025-01-25",
              "transactionCount": 520,
              "totalVolume": 78500000.00
            },
            {
              "date": "2025-01-24",
              "transactionCount": 485,
              "totalVolume": 72300000.00
            }
          ]
        }
      }
    },

    "error_response": {
      "description": "Standard error response format",
      "example": {
        "success": false,
        "timestamp": "2025-01-26T09:15:00Z",
        "error": {
          "code": "TRANSACTION_NOT_FOUND",
          "message": "Transaction with ID 9999 does not exist",
          "details": {
            "requestedId": 9999,
            "suggestion": "Please verify the transaction ID and try again"
          }
        }
      }
    }
  },

  "sql_to_json_mapping": {
    "description": "Documentation of how SQL tables map to JSON structures",
    "mappings": [
      {
        "sql_table": "users",
        "json_object": "user",
        "fields": {
          "UserId": "userId (integer)",
          "firstName": "firstName (string)",
          "MiddleName": "middleName (string|null)",
          "LastName": "lastName (string)",
          "PhoneNUmber": "phoneNumber (string)",
          "AccountType": "accountType (string)",
          "created_at": "createdAt (ISO 8601 datetime string)"
        },
        "notes": "Camel case conversion applied to field names. Datetime fields converted to ISO 8601 format with timezone."
      },
      {
        "sql_table": "transactions",
        "json_object": "transaction",
        "fields": {
          "TransactionId": "transactionId (integer)",
          "TxRef": "txRef (string - unique)",
          "CategoryId": "categoryId (integer - becomes nested category object)",
          "RawSmsId": "rawSmsId (integer - becomes nested rawSms object)",
          "Amount": "amount (decimal/float)",
          "Fee": "fee (decimal/float)",
          "BalanceAfter": "balanceAfter (decimal/float)",
          "TransactionDate": "transactionDate (ISO 8601 datetime)",
          "created_at": "createdAt (ISO 8601 datetime)"
        },
        "notes": "Foreign keys expanded into nested objects. Amounts represented as decimal floats for precision."
      },
      {
        "sql_table": "transaction_participants",
        "json_object": "participant (array)",
        "fields": {
          "ParticipantId": "participantId (integer)",
          "TransactionId": "transactionId (integer - omitted in nested context)",
          "UserId": "userId (integer - expanded to user object)",
          "Role": "role (string: 'sender'|'receiver')"
        },
        "notes": "Many-to-many relationship represented as array in transaction object. User details nested within each participant."
      },
      {
        "sql_table": "transaction_categories",
        "json_object": "category",
        "fields": {
          "CategoryId": "categoryId (integer)",
          "CategoryName": "categoryName (string)",
          "Description": "description (string)"
        },
        "notes": "Nested within transaction objects. Additional metadata can be added for frontend usage."
      },
      {
        "sql_table": "rsw_sms",
        "json_object": "rawSms",
        "fields": {
          "SmsId": "smsId (integer)",
          "SmsProtocol": "smsProtocol (string)",
          "SenderAddress": "senderAddress (string)",
          "ServiceCenter": "serviceCenter (string)",
          "SmsBody": "smsBody (string)",
          "ProcessedStatus": "processedStatus (string)",
          "ReceivedDate": "receivedDate (ISO 8601 datetime)",
          "created_at": "createdAt (ISO 8601 datetime)"
        },
        "notes": "Can be nested within transaction or returned as separate entity. Processing metadata added for tracking."
      },
      {
        "sql_table": "system_logs",
        "json_object": "log",
        "fields": {
          "LogId": "logId (integer)",
          "Status": "status (string)",
          "Source": "source (string)",
          "Message": "message (string)",
          "LoggedAt": "loggedAt (ISO 8601 datetime)"
        },
        "notes": "Detailed information can be nested in 'details' object for extensibility."
      }
    ],
    "general_conventions": {
      "naming": "SQL snake_case/PascalCase converted to camelCase in JSON",
      "dates": "All DATETIME fields serialized to ISO 8601 format with timezone (YYYY-MM-DDTHH:mm:ssZ)",
      "decimals": "DECIMAL fields represented as floats/numbers with appropriate precision",
      "nulls": "SQL NULL values represented as JSON null",
      "foreign_keys": "Foreign key relationships expanded into nested objects for complete API responses",
      "arrays": "One-to-many and many-to-many relationships represented as JSON arrays",
      "metadata": "Additional metadata objects can be added for API-specific data (processing info, statistics, etc.)"
    }
  }
}